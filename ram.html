<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
  <head>
    <title>SMB3 Memory Map</title>
    <link rel="stylesheet" href="./css/smw.css">
    <link rel="stylesheet" href="./css/newcss.css">
  </head>
  <body>
    <table cellpadding="0" cellspacing="0" width="100%">
      <tbody>
        <tr>
          <td align="center" height="180"><a href=".."><img src="./images/banner.png" alt="Banner"></a>
            <br>
          </td>
        </tr>
        <tr>
          <td height="10"></td>
        </tr>
        <tr>
          <td>
            <table cellpadding="0" cellspacing="0" width="100%">
              <tbody>
                <tr>
                  <td width="16" height="16"><img src="./images/tree_top_left.gif" alt=""></td>
                  <td height="16" style="background-image: url('./images/tree_top.gif');"></td>
                  <td width="16" height="16"><img src="./images/tree_top_right.gif" alt=""></td>
                </tr>
                <tr>
                  <td width="16" style="background-image: url('./images/tree_left.gif');"></td>
                  <td class="pad text">
                    <table cellpadding="0" class="generic">
                      <tbody><tr><td class="header">SMB3 RAM Map</td></tr>
                        <tr>
                          <td class="cell1">
                            <table class="grid" cellspacing="0">
                              <tbody>
                                <tr>
                                  <td>Displaying <span id="addr_count" class="stats">?</span> addresses.  (approximately <span class="stats">x%</span> complete) </td>
                                  <td class="space"></td>
                                  <td class="right">
                                    <!--
                                      <a href="">Show waiting addresses</a>
                                      - <a href="" class="user">Submit address</a>
                                    -->
                                  </td>
                                </tr>
                              </tbody>
                            </table>
                          </td>
                        </tr>
                        <tr><td class="space"></td></tr>
                      </tbody>
                    </table>
                    <a href="./data/ram.csv" download="ram.csv">Download RAM Map as CSV</a>
                    <table cellpadding="0" class="generic">
                      <tbody id="table_main">
                        <tr><td class="space"></td></tr>
                        <tr>
                          <td class="header">NES Address</td>
                          <td class="header">NES Label</td>
                          <td class="header">NES Length</td>
                          <td class="header">SNES Address</td>
                          <td class="header">SNES Label</td>
                          <td class="header">SNES Length</td>
                          <td class="header">GBA Address</td>
                          <td class="header">GBA Label</td>
                          <td class="header">GBA Length</td>
                          <td class="header">Type</td>
                          <td class="header">Description</td>
                        </tr>
                      </tbody>
                    </table>
                  </td>
                  <td width="16" style="background-image: url('./images/tree_right.gif');"></td>
                </tr>
                <tr>
                  <td width="16" height="16"><img src="./images/tree_bottom_left.gif" alt=""></td>
                  <td height="16" style="background-image: url('./images/tree_bottom.gif');"></td>
                  <td width="16" height="16"><img src="./images/tree_bottom_right.gif" alt=""></td>
                </tr>
              </tbody>
            </table>
          </td>
        </tr>
      </tbody>
    </table>
    <script src="./lib/papaparse.min.js"></script>
    <script>

      const ram_file = "./data/ram.csv";

      function table_write(){
	      var rows_found;
	      var table_main = document.getElementById("table_main");
	      var addr_count = document.getElementById("addr_count");
	      var base_elm;
	      var col_elm;
	      var col_link;

	      rows_found = 0;

	      Papa.parse(ram_file,{
		      header:true,
		      download:true,
		      //worker:true,
		      step:function(row){

			      base_elm = document.createElement("tr")

			      col_elm = document.createElement("td")
			      col_elm.className = "cell1 mono"
			      col_link = document.createElement("a")
			      col_link.href = "#NES_"+slice_hex_prefix(row.data.nes_address)
			      col_link.innerText = row.data.nes_address;
			      col_elm.appendChild(col_link)
			      col_elm.id = "#NES_"+slice_hex_prefix(row.data.nes_address)
			      base_elm.appendChild(col_elm)

			      col_elm = document.createElement("td")
			      col_elm.className = "cell1 nowrap"
			      col_elm.innerText = row.data.nes_label
			      base_elm.appendChild(col_elm)

			      col_elm = document.createElement("td")
			      col_elm.className = "cell1 nowrap"
			      col_elm.innerText = format_bytes(row.data.nes_size)
			      base_elm.appendChild(col_elm)

			      col_elm = document.createElement("td")
			      col_elm.className = "cell1 mono"
			      col_link = document.createElement("a")
			      col_link.href = "#SNES_"+slice_hex_prefix(row.data.snes_address)
			      col_link.innerText = row.data.snes_address
			      col_elm.appendChild(col_link)
			      col_elm.id = "#SNES_"+slice_hex_prefix(row.data.snes_address)
			      base_elm.appendChild(col_elm)

			      col_elm = document.createElement("td")
			      col_elm.className = "cell1 nowrap"
			      col_elm.innerText = row.data.snes_label
			      base_elm.appendChild(col_elm)

			      col_elm = document.createElement("td")
			      col_elm.className = "cell1 nowrap"
			      col_elm.innerText = format_bytes(row.data.snes_size)
			      base_elm.appendChild(col_elm)

			      col_elm = document.createElement("td")
			      col_elm.className = "cell1 mono"
			      col_link = document.createElement("a")
			      col_link.href = "#GBA_"+slice_hex_prefix(row.data.gba_address)
			      col_link.innerText = row.data.gba_address
			      col_elm.appendChild(col_link)
			      col_elm.id = "#GBA_"+slice_hex_prefix(row.data.gba_address)
			      base_elm.appendChild(col_elm)

			      col_elm = document.createElement("td")
			      col_elm.className = "cell1 nowrap"
			      col_elm.innerText = row.data.gba_label
			      base_elm.appendChild(col_elm)

			      col_elm = document.createElement("td")
			      col_elm.className = "cell1 nowrap"
			      col_elm.innerText = format_bytes(row.data.gba_size)
			      base_elm.appendChild(col_elm)

			      col_elm = document.createElement("td")
			      col_elm.className = "cell1"
			      col_elm.innerText = row.data.type
			      base_elm.appendChild(col_elm)

			      col_elm = document.createElement("td")
			      col_elm.className = "cell1"
			      col_elm.innerText = row.data.description
			      base_elm.appendChild(col_elm)

			      table_main.appendChild(base_elm)

			      ++rows_found;
		      },
		      complete:function(){
			      addr_count.innerText = rows_found;
		      }
	      });
      }

      function format_bytes(num){
	      return num + " byte"+(num!=1 ? "s" : "")
      }
      function slice_hex_prefix(num){
	      return num.slice(1);
      }

      table_write();

    </script>
  </body>
</html>
